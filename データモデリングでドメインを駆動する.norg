本書のテーマは**基幹系システム**の設計と**データモデリング**である。

* 1. 基幹系システムとデータモデリング

** 1.1 基幹系システムと帳簿はなぜ存在するか
    - **SoE(System of Engagement):** 顧客（やサプライヤー）との関係を構築するためのシステム
    - **SoR(System of Record): 記録のシステム**
    - 本書では基幹システム＝SoRにあたるもの。
    - データベースは単にドメインモデリングによって抽出されたオブジェクトが「永続化」されるストレージにすぎない。
    - 基幹系システムとは、 **企業の活動を指示・制御すること** を目的とする情報処理システムである。
    - 1つのイベント(例えば商品の購入)をトリガーにしていろいろな活動を指示、完了を記録して、処理漏れや二重処理が無いことを確認できるようにすることが、基幹系システムの基本的な役割である。
   ----  基幹系システムの中核には、「帳簿」がある。
      - 帳簿とは、ビジネスの活動を回すために用いられる、構造化された記録を意味する。
      - 帳簿が必要な理由は、異なるタイミングで実行される業務を結びつけること。
          - 例えば、カウンター越しに酒と代金を交換すれば、取引が完結するから帳簿は不要である。
          - 一方、店を出るときに支払う形式であれば、回収すべき代金はいくらなのかという伝票（＝帳簿）が必要である。
      - レストランの帳簿ならテーブル番号、品目、数量、デリバリー済みチェック欄を設けるだろう。これが**記録の構造化**。
      - 帳簿は、基幹系システムにおいて、処理より重要である。
      - どの順番で注文に対応するかという「ビジネスルール」は多少いい加減でも業務は回るが、受注残の帳簿がなければ誰に何を提供すればいいのかわからない。

** 1.2 データモデリングはなぜ必要か
   データモデリングとは帳簿をデザインすること
   **既存の帳簿を引き写すのではなく、新たな帳簿をデザインする**
   帳簿がすでに存在していて、そのデータモデルを作る場合、**データモデリングは分析と記述の問題**になる。
   多くの場合、変化に適応するために帳簿デザインの見直しも必要となる。
   既存の実相をもとにデータ項目を整理することに時間を費やすのでは既存の帳簿のコピーになりがちである。
   そのため、今後の事業活動のために帳簿をどのように仕組むかという工夫、帳簿デザインに注意を向けることが重要。

** 1.3 ERPはデータモデリングの重要性を減じるものではない
   現時点では、従来型ビジネスの基幹系システムは**ERP**(Enterprise Resource Planning, 企業資源計画)をもとに構築される場合も多い。
   データモデルは帳簿構造を理解し、業務と適合させるために必要である。
   スクラッチとはライブラリを使用せず、０からオリジナルで開発する手法。

** 1.4 既存の基幹系システムを解体し、新たな基幹系システムを構築する
   モノリシックとは、ソフトウェア設計の際、すべて同じモジュールで作り上げること、対義語は「マイクロ」。

* 2. 基幹系システムの構造
** 2.1 機関系システムのハイレベル構造はどのようなものか
   企業の活動を指示、制御するためには現場に直接向き合うこうした仕事だけで十分というわけではない。
   ではどのように区画されるのか。
   改めて、企業の活動を指示、制御するためには「指図」「引き当て」「消し込み」などに加えて、どのような仕事が必要だろうか。
   それは、長めのタイムレンジで、活動を計画し、調整することが必要である。
   なので、SoRの下位区分として、「活動のシステム」SoA(System of Activities)、「経営管理のシステム」SoM(Systems of Management)と呼ぶとわかりやすい。
   (SoA、SoMは本書固有の言葉)
   よって、SoR = SoA + SoM。
   この切り分けは、現状のシステム区分とずれている。
   **SoAとSoMでは、情報処理の性格が異なる**
   今日主流のリレーショナル・データベースはSoAにおけるデータ処理を主に念頭においている。
   SoAとSoMではシステムが変化する要因が異なる。
   関心の分離（SoC: Separation Of Concerns）
** 2.2 活動システム(SoA)は現場活動を支える
   SoA = 上位「業務プロセス」＋下位「業務機能」
*** 業務機能の分割は「残」に基づく
    業務機能のくくりは習慣的に決まっている面があるがSoAに限定して言えば、業務機能の最小単位は「残」を核として成立する
   「残」とは未処理の業務対象である。
    受注したが、出荷していないならその受注は「受注残」になる。
    「残」と業務機能が１対１に対応するわけでは無いが、ある特定の残の発生消滅まで管理する仕事というくくりが、SoAの業務機能の最小単位になる。
    なので、取引を扱う現場に近い管理業務（つまりSoA業務）に関して、責任が完結することを保証しながら業務機能を分割していくならば、最小単位は「残」にならざるを得ない。
*** 残がSoAの基本である
    業務機能に基づく分割と業務プロセスに基づく分割は排他的ではなく、いずれも必要だが前者のほうがより基本的だ。
    - 例えば、販売管理業務をさらに受注プロセス、出荷プロセス、請求プロセス、回収プロセスと分けるとする。
    - これが業務プロセス分割、すなわち **取引処理の流れに即した業務分割** である。
    - このように分割すると、それぞれの業務プロセスに関係する部署は複数あるが、そのうちどの部署が受注残、在庫残、売掛残に責任を持つのか不明瞭である。
    業務機能の最小機能の残管理は、普通複数種類の取引と関係している。
    そのため、業務プロセスすなわち取引処理の流れに即した業務分割だけでは、**残に対する管理責任が明瞭にならない**という特性がある。
    なので、取引処理の流れに即した分割は単独では片手落ちで、基礎に「残」視点の業務分割を要するのだ。

* 基幹系システム設計のアプローチ
** 3.1 帳簿デザインの進め方とシステム設計アプローチ
   **データ中心アプローチでは、データモデルで帳簿をデザインする**
** 3.2 ユーザーインターフェース設計だけでは帳簿をデザインできない
*** 帳簿の内容と表示の設計を分離する
   個々の画面や帳票は帳簿データを特定の視点からだけ表示するのが普通。
   画面・帳票は部分的なので帳簿データの構造自体を画面・帳票とは別の対象として設計することが必要。
   こうした帳簿データ構造の設計がデータモデル。
   画面・帳票の設計はむしろデータモデルに従うという位置づけになる。
*** ユースケースに依存しない帳簿デザインを追求する
    画面や帳票の設計は業務の流れ（ユースケース）に依存する。
    一方で、帳簿の構造は基本的には業務の流れに依存しないようにデザインする方が良い。
    データは処理より寿命が長いといわれる本質は業務機能はユースケースより安定していて、帳簿デザインは業務機能に従うという意味でもある。

*** データモデリングに画面、帳票スケッチを利用する
    帳簿のデザイン（データモデリング）には画面や帳票のスケッチを利用することは有用で重要である。
    というのも、データモデリングに使われるER図やUMLクラス図、それにデータで項目一覧表は綿密であっても、
    抽象的すぎてユーザーが帳簿デザインをしみじみと理解できるようなものではないから。
    粗くても具体的な帳票・画面のスケッチを書き、真実味のあるデータサンプルを記載して吟味したほうが、遥かに地に足のついた検討が可能になる。

** 3.3 データベース設計には技術的関心ことが混入する
**** ユーザーの関心事に集中する
     データモデリングをデータベース設計とはことなる別の設計として扱う理由は端的に言ってしまえば、データベースの **技術的側面を脇において** 、帳簿デザインに関するユーザーの関心ごとに集中する場を設けたいから。
     データベースの技術的側面というのは例えばサロゲートキーとナチュラルキーの選択である。
     ナチュラルキーは「得意先コード」「商品コード」などユーザーが業務上で用いるキーである。
     一方サロゲートキーはシステム内部で自動生成されユーザーの目に触れないキーであって、通常「ID」と呼ばれる。
     受注データと得意先データを関連付けるために得意先コードを用いるか、得意先コードを用いるかは技術的関心事であって、データモデルが扱うべき問題ではない。
     純粋に帳簿という観点に特化したデザインとして、データモデルを作成するわけです。
**** データモデルの等価性に注目する
     2つのデータモデルそれぞれで定義されたデータベースが、常にユーザーの目から見て違いないように双方向に変換可能であれば、その２つのデータモデルは等価である。
     ユーザーの目から見れば実質的に同じということ。

** 3.4 データモデルは基幹系システム設計の核心
   - データモデリングはユーザーインターフェース設計と異なり、業務の特定画面でのデータの見方やユースケースに依存しない。
   - データモデリングはデータベース設計とは異なり、技術的/実装的観点を含まない、ユーザー視点からの帳簿デザインである。
     基幹系システムを設計するときはデータモデルで帳簿をデザインし、UI設計やDB設計はそれに基づいて進めるという流れが基本的である。
     この手法は「データ中心アプローチ」（DOA: Data Oriented Approach）というコンセプト。

* 4. 活動のシステム（SoA） 残概念に基づく業務・帳簿の分割
** 4.1 残はバッファーである
   アジャイル開発ではバックログをつかって仕様定義と開発の間で一種のバッファリング装置として機能する。
   バックログに記載された案件は「開発残」とよんでもいい。
   残は活動と活動の間に置かれたバッファーである。

** 4.2 基幹系業務と残の例
*** 残の発生と解消を紐づけるのが残管理の基本-受注残を例に
    では、残概念を活用すると、どのようなデータモデルを構成できるだろうか。受注残を例に考えてみる。
    まず、業務を駆動する残自体を表すデータが必要である。
    加えて残を発生させるイベント、解消するイベントに関するデータが必要である。
    この３つがデータモデルの核心になる。
    - データモデルノデータ項目は、単なる「業務上の決め事」ではなく、相応の必要性があって決まるのである。
    - 業務のあり方を踏まえて各項目の要否や別のデータ項目での代替可否を検討し、項目を決定することがデータモデリングであって、ユーザーから聞き取った項目を図にするだけなのはただのデータモデルの作図。
